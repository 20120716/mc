<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>iPad MyCraft Online</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; touch-action: none; font-family: sans-serif; }
        #ui { position: fixed; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 8px; pointer-events: none; }
        #hotbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 12px; }
        .slot { width: 50px; height: 50px; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; cursor: pointer; }
        .slot.active { border-color: #ff0; background: rgba(255,255,0,0.3); }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid white; transform: translate(-50%, -50%); pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">XYZ: <span id="pos">0/0/0</span><br>タップでブロック設置</div>
    <div id="crosshair"></div>
    <div id="hotbar">
        <div class="slot active" onclick="setBlock(0)">草</div>
        <div class="slot" onclick="setBlock(1)">石</div>
        <div class="slot" onclick="setBlock(2)">木</div>
        <div class="slot" onclick="setBlock(3)">土</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let selectedMaterial = 0;
        const colors = [0x5d9948, 0x808080, 0x8b4513, 0x553311]; // 草, 石, 木, 土

        function setBlock(id) {
            selectedMaterial = id;
            const slots = document.querySelectorAll('.slot');
            slots.forEach((s, i) => s.className = i === id ? 'slot active' : 'slot');
        }

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const geo = new THREE.BoxGeometry(1, 1, 1);
        const blocks = [];

        // 初期地面
        for(let x=-5; x<=5; x++) {
            for(let z=-5; z<=5; z++) {
                createBlock(x, 0, z, 0);
            }
        }

        function createBlock(x, y, z, matId) {
            const mat = new THREE.MeshLambertMaterial({ color: colors[matId] });
            const b = new THREE.Mesh(geo, mat);
            b.position.set(x, y, z);
            scene.add(b);
            blocks.push(b);
        }

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const light = new THREE.DirectionalLight(0xffffff, 0.5);
        light.position.set(10, 20, 10);
        scene.add(light);

        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);
        camera.rotation.order = 'YXZ';

        // --- 操作系 ---
        let lastX, lastY;
        window.addEventListener('touchstart', e => {
            if(e.target.className.includes('slot')) return;
            lastX = e.touches[0].pageX;
            lastY = e.touches[0].pageY;
        });

        window.addEventListener('touchmove', e => {
            if(e.target.className.includes('slot')) return;
            const dx = e.touches[0].pageX - lastX;
            const dy = e.touches[0].pageY - lastY;
            camera.rotation.y -= dx * 0.005;
            camera.rotation.x = Math.max(-1.5, Math.min(1.5, camera.rotation.x - dy * 0.005));
            lastX = e.touches[0].pageX;
            lastY = e.touches[0].pageY;
        });

        // タップでブロック設置
        window.addEventListener('touchend', e => {
            if(e.target.className.includes('slot')) return;
            // 前方にブロックを置く簡易システム
            const dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            const pos = camera.position.clone().add(dir.multiplyScalar(3));
            createBlock(Math.round(pos.x), Math.round(pos.y), Math.round(pos.z), selectedMaterial);
        });

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
            document.getElementById('pos').innerText = 
                `${Math.round(camera.position.x)}/${Math.round(camera.position.y)}/${Math.round(camera.position.z)}`;
        }
        animate();
    </script>
</body>
</html>
